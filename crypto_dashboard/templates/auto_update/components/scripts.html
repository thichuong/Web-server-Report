<!-- Scripts -->
<script src="{{ url_for('static', filename='js/theme-manager.js') }}" defer></script>
<script type="module" src="{{ url_for('static', filename='js/auto_update.js') }}" defer></script>

<!-- Socket.IO CDN -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<!-- PWA Installation Script -->
<script>
// Make PWA manager available globally
window.addEventListener('load', async () => {
    const { pwaManager } = await import('{{ url_for("static", filename="js/modules/pwa-manager.js") }}');
    window.pwaManager = pwaManager;
    
    // Update WebSocket status indicator
    const { wsClient } = await import('{{ url_for("static", filename="js/modules/websocket-client.js") }}');
    
    const wsStatusIndicator = document.getElementById('ws-status-indicator');
    const connectionTypeElement = document.getElementById('connection-type');
    
    wsClient.onConnectionChange((state, data) => {
        if (wsStatusIndicator) {
            switch (state) {
                case 'connected':
                    wsStatusIndicator.className = 'ws-status-indicator ws-connected';
                    wsStatusIndicator.innerHTML = '<i class="fas fa-circle"></i> WebSocket';
                    
                    if (connectionTypeElement) {
                        connectionTypeElement.className = 'status-indicator status-active';
                        connectionTypeElement.innerHTML = '<i class="fas fa-bolt mr-2"></i>Real-time (WebSocket)';
                    }
                    break;
                    
                case 'disconnected':
                case 'error':
                    wsStatusIndicator.className = 'ws-status-indicator ws-disconnected';
                    wsStatusIndicator.innerHTML = '<i class="fas fa-circle"></i> Disconnected';
                    
                    if (connectionTypeElement) {
                        connectionTypeElement.className = 'status-indicator status-inactive';
                        connectionTypeElement.innerHTML = '<i class="fas fa-clock mr-2"></i>Polling (Fallback)';
                    }
                    break;
                    
                default:
                    wsStatusIndicator.className = 'ws-status-indicator ws-connecting';
                    wsStatusIndicator.innerHTML = '<i class="fas fa-circle"></i> Connecting...';
                    
                    if (connectionTypeElement) {
                        connectionTypeElement.className = 'status-indicator status-inactive';
                        connectionTypeElement.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Kết nối...';
                    }
            }
        }
    });
    
    // Listen for network status changes
    window.addEventListener('network-status-change', (event) => {
        const isOnline = event.detail.isOnline;
        console.log('Network status changed:', isOnline ? 'Online' : 'Offline');
    });
});
</script>
